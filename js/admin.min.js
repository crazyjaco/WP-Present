var WPPresentAdmin
!function(n){WPPresentAdmin=function(){return this.init(),this},WPPresentAdmin.prototype={init:function(){var e=this,t=n("#container").width(),o=210
n("#outer-container").resizable(),n("#container").width(t+o),n("#container").sortable({stop:function(){e.updateTaxonomyDescription(),e.updatePresentation()}}),n(".column-inner").sortable({connectWith:".column-inner",stop:function(){e.updateTaxonomyDescription(),e.updatePresentation()}}),e.widgetButtonExpand(),e.widgetButtonEdit(),e.widgetButtonDelete(),e.widgetButtonAdd(),e.widgetButtonTidy(),e.bindButtonAddColumn(),e.bindButtonRemoveColumn(),e.bindButtonViewPresentation(),e.refreshUI()
var i=n("#col-1").children(".widget-top").children(".widget-title")
return e.activateColumn(i),""==n("#description").val()&&(e.updateTaxonomyDescription(),e.updatePresentation()),n(".spinner").hide(),e},refreshUI:function(){var e=this
n("#container").sortable("refresh"),n(".column").not(":has(div.column-inner)").append('<div class="column-inner ui-sortable"></div>'),n(".column-inner").data("sortable")?n(".column-inner").sortable("refresh"):n(".column-inner").sortable({connectWith:".column-inner",stop:function(){e.updateTaxonomyDescription(),e.updatePresentation()}}),e.enableColumns()},backfillColumns:function(){for(var e=this,t=WPPNumSlides[0],o=n("#container > .column").size(),i=o+1;t>=i;i++)e.addColumn()},activateColumn:function(e){var t=n(".widget-title")
t.css({background:"",color:""}),t.removeClass("active"),e.css({"background-color":"#0074a2",color:"#ffffff"}),e.addClass("active")},updateTaxonomyDescription:function(){var e=this,t={},o=1
n(".column-inner").each(function(){var e=n(this).sortable("toArray")
t["col-"+o]=e,o++})
var i=JSON.stringify(t)
n("#description").val(i),e.renumberColumns(),e.updatePresentation()},updatePresentation:function(){var e=n("#wp-present-nonce").val(),t={content:n("#description").val(),id:presentation,nonce:e}
n.ajax({url:ajaxurl+"?action=update_presentation",type:"POST",data:jQuery.param(t),beforeSend:function(){n(".spinner").show()},complete:function(){},success:function(){n(".spinner").hide()}})},widgetButtonTidy:function(){n(".action-buttons").on("click","#tidy-button",function(n){n.preventDefault(),this.consolidateColumns()})},widgetButtonExpand:function(){n("#container").on("click",".widget-title-action",function(){n(this).parents(".widget").children(".widget-inside").toggle()})},consolidateColumns:function(){var e=this,t=n(".column").length
n(".column").each(function(e){var e=e+1
if(!(e>=t)){var o=n(this),i=o.children(".column-inner"),a=i.html().trim(),c=o.html().trim()
if("string"!=typeof a||""==a){var r=n("#col-"+(e+1)),d=r.html().trim()
o.html(d),r.html(c)}}}),n(".column-inner").sortable({connectWith:".column-inner",stop:function(){e.updateTaxonomyDescription()},create:function(){e.updateTaxonomyDescription()}}),e.updateTaxonomyDescription()},enableColumns:function(){var e=this
n(".column").children(".widget-top").on("click",".widget-title",function(){var t=n(this)
e.activateColumn(t)})},widgetButtonEdit:function(){var e=this
n("#container").on("click",".widget-control-edit",function(t){t.preventDefault()
var o=n(this),i=o.parents(".widget"),a=i.find(".widget-preview"),c=i.find(".slide-id").val(),r=n("#wp-present-nonce").val()
n("#editor_slide-tmce").click(),n("#dialog").dialog({autoOpen:!0,width:640,height:640,modal:!1,buttons:{Update:function(){var t=tinymce.get("editor_slide").getContent(),o={content:t,id:c,nonce:r}
n.ajax({url:ajaxurl+"?action=update_slide",type:"POST",data:jQuery.param(o),beforeSend:function(){n(".spinner").show()},complete:function(){},success:function(e){n(".spinner").hide(),a.html(e)}}),e.closeModal()},Cancel:function(){e.closeModal()}},create:function(){tinymce.execCommand("mceRemoveControl",!0,"editor_slide"),tinymce.execCommand("mceAddControl",!0,"editor_slide")},open:function(){var e=n("#wp-present-nonce").val(),t={id:c,nonce:e}
n.ajax({url:ajaxurl+"?action=get_slide",data:jQuery.param(t),beforeSend:function(){n(".spinner").show()},complete:function(){n(".spinner").hide()},success:function(n){tinymce.get("editor_slide").setContent(n)}})
var o=n("#editor_slide_ifr").contents()
o.find("body").addClass("reveal"),o.css("height","500px")},close:function(){e.closeModal()}})})},widgetButtonDelete:function(){var e=this
n("#container").on("click",".widget-control-remove",function(t){t.preventDefault()
var o=confirm("You are about to permanently delete the selected slide. 'Cancel' to stop, 'OK' to delete.")
if(!1!==o){var i=n(this),a=i.parents(".widget"),c=a.find(".slide-id").val(),r=n("#wp-present-nonce").val(),d={id:c,nonce:r}
n.ajax({url:ajaxurl+"?action=delete_slide",type:"POST",data:jQuery.param(d),beforeSend:function(){n(".spinner").show()},complete:function(){},success:function(){n(".spinner").hide(),a.remove(),e.updateTaxonomyDescription()}})}})},widgetButtonAdd:function(){var e=this
n(".action-buttons").on("click","#add-button",function(t){t.preventDefault()
var o=n(".widget-title.active").parent(".widget-top").parent(".column").children(".column-inner")
n("#editor_slide-tmce").click(),n("#dialog").dialog({autoOpen:!0,width:600,height:600,modal:!1,buttons:{Publish:function(){var t=tinymce.get("editor_slide").getContent(),i=n("#wp-present-nonce").val(),a={content:t,presentation:presentation,nonce:i}
n.ajax({url:ajaxurl+"?action=new_slide",type:"POST",data:jQuery.param(a),success:function(n){o.append(n),WPPNumSlides[0]++,e.refreshUI(),e.updateTaxonomyDescription()}}),e.closeModal()},Cancel:function(){e.closeModal()}},create:function(){tinymce.execCommand("mceRemoveControl",!0,"editor_slide"),tinymce.execCommand("mceAddControl",!0,"editor_slide")},open:function(){tinymce.get("editor_slide").setContent("")
var e=n("#editor_slide_ifr").contents()
e.find("body").addClass("reveal")},close:function(){e.closeModal()}})})},addColumn:function(){var e=this,t=n("#container > .column").size()+1,o=n("#container").width(),i=210
n(".widget-title.active").parent(".widget-top").parent(".column").after('<div class="column ui-sortable" id="col-'+t+'"><div class="widget-top"><div class="widget-title"><h4 class="hndle">'+t+'<span class="in-widget-title"></span></h4></div></div></div>'),n("#container").width(o+i),e.renumberColumns()},removeColumn:function(){var e=confirm("You are about to permanently delete the selected column. 'Cancel' to stop, 'OK' to delete.")
if(!1!==e){var t=this,o=n("#container").width(),i=210
n(".widget-title.active").parent(".widget-top").parent(".column").remove(),n("#container").width(o-i),t.renumberColumns()
var a=n("#col-1").children(".widget-top").children(".widget-title")
t.activateColumn(a)}},bindButtonAddColumn:function(){var e=this
n(".action-buttons").on("click","#add-column",function(n){n.preventDefault(),e.addColumn(),e.refreshUI(),e.updateTaxonomyDescription(),e.updatePresentation()})},bindButtonRemoveColumn:function(){var e=this
n(".action-buttons").on("click","#remove-column",function(n){n.preventDefault(),e.removeColumn(),e.refreshUI(),e.updateTaxonomyDescription(),e.updatePresentation()})},bindButtonViewPresentation:function(){n(".action-buttons").on("click","#view-button",function(n){n.preventDefault(),window.open(WPPTaxonomyURL,"_blank")})},renumberColumns:function(){var e=1
n(".column").each(function(){var t=this,o=n(t)
o.find("> .widget-top > .widget-title > h4").html(e),e++})},closeModal:function(){tinymce.execCommand("mceRemoveControl",!0,"editor_slide"),n("#dialog").dialog("close")}}}(jQuery)
var slideManager=new WPPresentAdmin